/*
* storeLocator v1.4.3 - jQuery Google Maps Store Locator Plugin
* (c) Copyright 2013, Bjorn Holine (http://www.bjornblog.com)
* Released under the MIT license
* Distance calculation function by Chris Pietschmann: http://pietschsoft.com/post/2008/02/01/Calculate-Distance-Between-Geocodes-in-C-and-JavaScript.aspx
*/

(function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"loc-list",formContainerDiv:"form-container",formID:"user-location",inputID:"address",zoomLevel:12,pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:26,distanceAlert:60,dataType:"xml",dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",originMarker:false,originpinColor:"blue",bounceMarker:true,slideMap:true,modalWindow:false,overlayDiv:"overlay",modalWindowDiv:"modal-window",modalContentDiv:"modal-content",modalCloseIconDiv:"close-icon",defaultLoc:false,defaultLat:"",defaultLng:"",autoGeocode:false,maxDistance:false,maxDistanceID:"maxdistance",fullMapStart:false,noForm:false,loading:false,loadingDiv:"loading-map",infowindowTemplatePath:"templates/infowindow-description.html",listTemplatePath:"templates/location-list-description.html",KMLinfowindowTemplatePath:"templates/kml-infowindow-description.html",KMLlistTemplatePath:"templates/kml-location-list-description.html",callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null,geocodeErrorAlert:"Geocode was not successful for the following reason: ",blankInputAlert:"The input box was blank.",addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers",jsonpCallback:null},b);
return this.each(function(){var h=a(this);var e,g;f();function f(){if(c.dataType==="kml"){a.get(c.KMLinfowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.KMLlistTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}else{a.get(c.infowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.listTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}}function d(){var i,x,s,l,z,k;var p=[];var v="storeLocator";if(c.modalWindow===true){h.wrap('<div id="'+c.overlayDiv+'"><div id="'+c.modalWindowDiv+'"><div id="'+c.modalContentDiv+'">');
a("#"+c.modalWindowDiv).prepend('<div id="'+c.modalCloseIconDiv+'"></div>');a("#"+c.overlayDiv).hide();}if(c.slideMap===true){h.hide();}var j={};if(c.lengthUnit==="km"){j.EarthRadius=6367;
}else{j.EarthRadius=3956;}j.ToRadian=function(r){return r*(Math.PI/180);};j.DiffRadian=function(B,r){return j.ToRadian(r)-j.ToRadian(B);};j.CalcDistance=function(E,D,C,B,r){return r*2*Math.asin(Math.min(1,Math.sqrt((Math.pow(Math.sin((j.DiffRadian(E,C))/2),2)+Math.cos(j.ToRadian(E))*Math.cos(j.ToRadian(C))*Math.pow(Math.sin((j.DiffRadian(D,B))/2),2)))));
};function w(){geocoder=new google.maps.Geocoder();this.geocode=function(r,B){geocoder.geocode({address:r},function(E,D){if(D==google.maps.GeocoderStatus.OK){var C={};
C.latitude=E[0].geometry.location.lat();C.longitude=E[0].geometry.location.lng();B(C);}else{alert(c.geocodeErrorAlert+D);B(null);}});};}function A(){geocoder=new google.maps.Geocoder();
this.geocode=function(B,r){geocoder.geocode({latLng:B},function(E,D){if(D==google.maps.GeocoderStatus.OK){if(E[0]){var C={};C.address=E[0].formatted_address;
r(C);}}else{alert(c.geocodeErrorAlert+D);r(null);}});};}function t(r,B){return Math.round(r*Math.pow(10,B))/Math.pow(10,B);}if(c.defaultLoc===true){var u=new A();
var n=new google.maps.LatLng(c.defaultLat,c.defaultLng);u.geocode(n,function(B){if(B!==null){var r=B.address;o(c.defaultLat,c.defaultLng,r);}else{alert(c.addressErrorAlert);
}});}if(c.fullMapStart===true){o();}if(c.autoGeocode===true){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(q,y);}}function q(B){var C=new A();
var D=new google.maps.LatLng(B.coords.latitude,B.coords.longitude);C.geocode(D,function(E){if(E!==null){var r=E.address;o(B.coords.latitude,B.coords.longitude,r);
}else{alert(c.addressErrorAlert);}});}function y(r){alert(c.autoGeocodeErrorAlert);}function m(D){var C=a("#"+c.inputID).val();if(C===""){alert(c.blankInputAlert);
}else{var B=new w();var r=C;B.geocode(r,function(E){if(E!==null){x=E.latitude;s=E.longitude;o(x,s,C,D);}else{alert(c.addressErrorAlert);}});}}a(function(){function r(C){C.preventDefault();
if(c.maxDistance===true){var B=a("#"+c.maxDistanceID).val();m(B);}else{m();}}if(c.noForm===true){a(document).on("click."+v,"#"+c.formContainerDiv+" #submit",function(B){r(B);
});a(document).on("keyup."+v,function(B){if(B.keyCode===13){r(B);}});}else{a(document).on("submit."+v,"#"+c.formID,function(B){r(B);});}});function o(r,C,B,D){a(function(){var E;
p=[];if(c.dataType==="kml"){E="xml";}else{E=c.dataType;}a.ajax({type:"GET",url:c.dataLocation+(c.dataType==="jsonp"?(c.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:E,jsonpCallback:c.dataType==="jsonp"?c.jsonpCallback:null,beforeSend:function(){if(c.callbackBeforeSend){c.callbackBeforeSend.call(this);
}if(c.loading===true){a("#"+c.formContainerDiv).append('<div id="'+c.loadingDiv+'"></div>');}},complete:function(H,G,F){if(c.callbackComplete){c.callbackComplete.call(this,H,G,F);
}if(c.loading===true){a("#"+c.loadingDiv).remove();}},success:function(H,J,F){if(c.callbackSuccess){c.callbackSuccess.call(this,H,J,F);}var G=0;var I;if(c.fullMapStart===true&&a("#"+c.mapDiv).hasClass("mapOpen")===false){I=true;
}a("#"+c.mapDiv).addClass("mapOpen");if(c.dataType==="json"||c.dataType==="jsonp"){a.each(H,function(){var O=this.locname;var X=this.lat;var Y=this.lng;
var Z=this.address;var N=this.address2;var T=this.city;var M=this.state;var V=this.postal;var W=this.phone;var U=this.web;U=U.replace("http://","");var S=this.hours1;
var R=this.hours2;var Q=this.hours3;var P=this.category;var L=j.CalcDistance(r,C,X,Y,j.EarthRadius);if(c.maxDistance===true&&I!==true){if(L<D){p[G]=[L,O,X,Y,Z,N,T,M,V,W,U,S,R,Q,P];
}else{return;}}else{p[G]=[L,O,X,Y,Z,N,T,M,V,W,U,S,R,Q,P];}G++;});}else{if(c.dataType==="kml"){a(H).find("Placemark").each(function(){var M=a(this).find("name").text();
var O=a(this).find("coordinates").text().split(",")[1];var L=a(this).find("coordinates").text().split(",")[0];var N=a(this).find("description").text();
var P=j.CalcDistance(r,C,O,L,j.EarthRadius);if(c.maxDistance===true&&I!==true){if(P<D){p[G]=[P,M,O,L,N];}else{return;}}else{p[G]=[P,M,O,L,N];}G++;});}else{a(H).find("marker").each(function(){var O=a(this).attr("name");
var X=a(this).attr("lat");var Y=a(this).attr("lng");var Z=a(this).attr("address");var N=a(this).attr("address2");var T=a(this).attr("city");var M=a(this).attr("state");
var V=a(this).attr("postal");var W=a(this).attr("phone");var U=a(this).attr("web");U=U.replace("http://","");var S=a(this).attr("hours1");var R=a(this).attr("hours2");
var Q=a(this).attr("hours3");var P=a(this).attr("category");var L=j.CalcDistance(r,C,X,Y,j.EarthRadius);if(c.maxDistance===true&&I!==true){if(L<D){p[G]=[L,O,X,Y,Z,N,T,M,V,W,U,S,R,Q,P];
}else{return;}}else{p[G]=[L,O,X,Y,Z,N,T,M,V,W,U,S,R,Q,P];}G++;});}}p.sort(function(N,M){var L=N[0];var O=M[0];return((L<O)?-1:((L>O)?1:0));});var K=(c.lengthUnit==="km")?c.kilometersLang:c.milesLang;
if(c.maxDistance===true&&I!==true){if(p[0]===undefined||p[0][0]>D){alert(c.distanceErrorAlert+D+" "+K);return;}}else{if(p[0][0]>c.distanceAlert){alert(c.distanceErrorAlert+c.distanceAlert+" "+K);
}}a(function(){var aq,ai,ag,ae,T,al,M,an,U,ac,aa,Z,ak,ad;function V(ar){aq=p[ar][0];aq=t(aq,2);ai=p[ar][1];ag=p[ar][4];ae=p[ar][5];T=p[ar][6];al=p[ar][7];
M=p[ar][8];an=p[ar][9];U=p[ar][10];ac=p[ar][11];aa=p[ar][12];Z=p[ar][13];ad=p[ar][14];}function X(ar){aq=p[ar][0];aq=t(aq,2);ai=p[ar][1];ak=p[ar][4];}function O(aw){if(c.dataType==="kml"){X(aw.get("id"));
}else{V(aw.get("id"));}var au;if(aq<=1){if(c.lengthUnit==="km"){au=c.kilometerLang;}else{au=c.mileLang;}}else{if(c.lengthUnit==="km"){au=c.kilometersLang;
}else{au=c.milesLang;}}var av=aw.get("id");if(c.storeLimit>26){var at=av+1;}else{var at=String.fromCharCode("A".charCodeAt(0)+av);}if(c.dataType==="kml"){var ar={location:[{distance:aq,markerid:av,marker:at,name:ai,description:ak,length:au,origin:B}]};
}else{var ar={location:[{distance:aq,markerid:av,marker:at,name:ai,address:ag,address2:ae,city:T,state:al,postal:M,phone:an,web:U,hours1:ac,hours2:aa,hours3:Z,length:au,origin:B,category:ad}]};
}return ar;}if(c.slideMap===true){h.slideDown();}if(c.modalWindow===true){if(c.callbackModalOpen){c.callbackModalOpen.call(this);}function N(){if(c.callbackModalOpen){c.callbackModalOpen.call(this);
}a("#"+c.overlayDiv).hide();}a("#"+c.overlayDiv).fadeIn();a(document).on("click."+v,"#"+c.modalCloseIconDiv+", #"+c.overlayDiv,function(){N();});a(document).on("click."+v,"#"+c.modalWindowDiv,function(ar){ar.stopPropagation();
});a(document).on("keyup."+v,function(ar){if(ar.keyCode===27){N();}});}if((c.fullMapStart===true&&I===true)||c.zoomLevel===0){var af={mapTypeId:google.maps.MapTypeId.ROADMAP};
var R=new google.maps.LatLngBounds();}else{var af={zoom:c.zoomLevel,center:new google.maps.LatLng(r,C),mapTypeId:google.maps.MapTypeId.ROADMAP};}var ao=new google.maps.Map(document.getElementById(c.mapDiv),af);
var am=[];var Y=new google.maps.InfoWindow();if((p.length-1)<c.storeLimit-1){k=p.length-1;}else{k=c.storeLimit-1;}if(c.originMarker===true&&c.fullMapStart===false){var Q=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
var ab=new google.maps.LatLng(r,C);var S=new google.maps.Marker({position:ab,map:ao,icon:"http://maps.google.com/mapfiles/ms/icons/"+c.originpinColor+"-dot.png",shadow:Q,draggable:false});
}for(var W=0;W<=k;W++){var ap=String.fromCharCode("A".charCodeAt(0)+W);var aj=new google.maps.LatLng(p[W][2],p[W][3]);S=L(aj,p[W][1],p[W][4],ap,p[W][14]);
S.set("id",W);am[W]=S;if((c.fullMapStart===true&&I===true)||c.zoomLevel===0){R.extend(aj);}P(S);}if((c.fullMapStart===true&&I===true)||c.zoomLevel===0){ao.fitBounds(R);
}a("#"+c.listDiv+" ul").empty();a(am).each(function(ar,at){var au=String.fromCharCode("A".charCodeAt(0)+ar);var av=am[ar];ah(av);});function ah(at){var ar=O(at);
var au=e(ar);a("#"+c.listDiv+" ul").append(au);}a(document).on("click."+v,"#"+c.listDiv+" li",function(){var au=a(this).data("markerid");var at=am[au];
a("#"+c.listDiv+" li").removeClass("list-focus");a("#"+c.listDiv+" li[data-markerid="+au+"]").addClass("list-focus");ao.panTo(at.getPosition());var ar="left";
if(c.bounceMarker===true){at.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){at.setAnimation(null);P(at,ar);},700);}else{P(at,ar);}});
a("#"+c.listDiv+" ul li:even").css("background","#"+c.listColor1);a("#"+c.listDiv+" ul li:odd").css("background","#"+c.listColor2);function L(ar,av,au,az,ax){var ay=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+az+"|"+c.pinColor+"|"+c.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));
var aw=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
if(c.storeLimit>26){var at=new google.maps.Marker({position:ar,map:ao,draggable:false});}else{var at=new google.maps.Marker({position:ar,map:ao,icon:ay,shadow:aw,draggable:false});
}return at;}function P(av,au){var at=O(av);var ar=g(at);if(au==="left"){Y.setContent(ar);Y.open(av.get(c.mapDiv),av);}else{google.maps.event.addListener(av,"click",function(){Y.setContent(ar);
Y.open(av.get(c.mapDiv),av);a("#"+c.listDiv+" li").removeClass("list-focus");markerId=av.get("id");a("#"+c.listDiv+" li[data-markerid="+markerId+"]").addClass("list-focus");
var aw=a("#"+c.listDiv),ax=a("#"+c.listDiv+" li[data-markerid="+markerId+"]");a("#"+c.listDiv).animate({scrollTop:ax.offset().top-aw.offset().top+aw.scrollTop()});
});}}});}});});}}});};})(jQuery);